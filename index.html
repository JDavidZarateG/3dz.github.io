<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3DZ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
    <div class="header-content">
        <img src="Images/LOGO 3DZ.png" alt="Logo 3DZ" class="logo">
        <nav>
            <a href="index.html">Inicio</a>
            <a href="#catalog">Cat치logo</a>
            <a href="nosotros.html">Nosotros</a>
            <a href="contacto.html">Contacto</a>
            <a href="cart.html" class="cart-link">
                游 Carrito <span id="cart-count">0</span>
            </a>
        </nav>
    </div>
</header>

    <div class="container">
        <!-- Secci칩n de Galer칤a de Im치genes -->
        <section class="gallery">
            <h2>Galer칤a de Productos Destacados</h2>
            <div class="carousel" id="carousel">
                <img src="Images/Inventory/HeartBox.png" alt="Producto Destacado 1">
                <img src="Images/Inventory/TeddyBearKeyChain.png" alt="Producto Destacado 2">
                <img src="Images/Inventory/PlantPotSuculentBlackModel1.png" alt="Producto Destacado 3">
                <img src="Images/Inventory/NikeRunningShoe.png" alt="Producto Destacado 4">
            </div>
            <div class="carousel-controls">
                <button id="prev">&lt;</button>
                <button id="next">&gt;</button>
            </div>
            <div class="indicators" id="indicators">
                <div class="indicator active" data-slide="0"></div>
                <div class="indicator" data-slide="1"></div>
                <div class="indicator" data-slide="2"></div>
                <div class="indicator" data-slide="3"></div>
            </div>
        </section>

        <h2>Cat치logos de Productos</h2>

        <!-- Filtros por categor칤a -->
        <div class="filters">
            <button class="filter-btn active" data-category="all">Todos</button>
            <button class="filter-btn" data-category="materas">Materas</button>
            <button class="filter-btn" data-category="llaveros">Llaveros</button>
            <button class="filter-btn" data-category="accesorios">Accesorios</button>
        </div>

        <div class="catalog" id="catalog">
            <!-- Los productos se generan aqu칤 -->
        </div>

       <script>
    // Carrito global
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let productosData = []; // Guardar productos aqu칤

    // Funci칩n para cargar y generar productos
    async function cargarProductos() {
        try {
            const response = await fetch('products.json');
            productosData = await response.json(); // Guardar datos
            
            const catalog = document.getElementById('catalog');
            
            productosData.forEach((producto, index) => {
                const div = document.createElement('div');
                div.className = 'product';
                div.setAttribute('data-category', producto.category);
                div.setAttribute('data-index', index); // Usar 칤ndice
                
                // Verificar stock
                const stockClass = producto.stock > 0 ? 'in-stock' : 'out-of-stock';
                const stockText = producto.stock > 0 ? `Stock: ${producto.stock}` : 'Agotado';
                
                div.innerHTML = `
                    <img src="${producto.image}" alt="${producto.title}">
                    <h2>${producto.title}</h2>
                    <p>${producto.short_description}</p>
                    <h2>Precio: ${producto.price} COP</h2>
                    <p class="stock ${stockClass}">${stockText}</p>
                    <div class="quantity-controls">
                        <button class="qty-btn minus" onclick="changeQty(${index}, -1)">-</button>
                        <span class="qty-display" id="qty-${index}">1</span>
                        <button class="qty-btn plus" onclick="changeQty(${index}, 1)">+</button>
                    </div>
                    <button class="add-to-cart" onclick="addToCart(${index})" ${producto.stock === 0 ? 'disabled' : ''}>
                        ${producto.stock > 0 ? 'A침adir al Carrito' : 'Agotado'}
                    </button>
                `;
                
                catalog.appendChild(div);
            });

            inicializarFiltrosYEventos();
            updateCartCount();
        } catch (error) {
            console.error('Error cargando productos:', error);
        }
    }

    // Cambiar cantidad usando 칤ndice
    function changeQty(index, change) {
        const producto = productosData[index];
        const qtyDisplay = document.getElementById(`qty-${index}`);
        
        if (!qtyDisplay || !producto) return;
        
        let currentQty = parseInt(qtyDisplay.textContent);
        const stock = producto.stock;
        
        const newQty = currentQty + change;
        
        if (newQty >= 1 && newQty <= stock) {
            qtyDisplay.textContent = newQty;
        }
    }

    // A침adir al carrito usando 칤ndice
    function addToCart(index) {
        const producto = productosData[index];
        const qtyDisplay = document.getElementById(`qty-${index}`);
        const quantity = parseInt(qtyDisplay.textContent);
        
        const { title, price, image, stock } = producto;
        
        // Buscar si ya existe en el carrito
        const existingItem = cart.find(item => item.title === title);
        
        if (existingItem) {
            const newTotal = existingItem.quantity + quantity;
            if (newTotal <= stock) {
                existingItem.quantity = newTotal;
            } else {
                alert(`Solo hay ${stock} unidades disponibles`);
                return;
            }
        } else {
            if (quantity <= stock) {
                cart.push({ title, price, image, quantity, stock });
            } else {
                alert(`Solo hay ${stock} unidades disponibles`);
                return;
            }
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        alert(`A침adido: ${quantity} x ${title}`);
        
        // Resetear cantidad a 1
        qtyDisplay.textContent = 1;
    }

    // Actualizar contador del carrito
    function updateCartCount() {
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartBadge = document.getElementById('cart-count');
        if (cartBadge) {
            cartBadge.textContent = count;
        }
    }

    // Funci칩n para inicializar filtros y eventos
    function inicializarFiltrosYEventos() {
        const filterButtons = document.querySelectorAll('.filter-btn');
        const products = document.querySelectorAll('.product');

        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const category = button.getAttribute('data-category');

                products.forEach(product => {
                    if (category === 'all' || product.getAttribute('data-category') === category) {
                        product.style.display = 'block';
                    } else {
                        product.style.display = 'none';
                    }
                });
            });
        });

        // Evento click para ir a detalles del producto
        products.forEach(product => {
            product.addEventListener('click', (e) => {
                if (e.target.classList.contains('qty-btn') || e.target.classList.contains('add-to-cart')) {
                    return;
                }
                
                const index = product.getAttribute('data-index');
                const p = productosData[index];
                
                const title = encodeURIComponent(p.title);
                const description = encodeURIComponent(p.large_description);
                const price = encodeURIComponent(p.price);
                const image = encodeURIComponent(p.image);
                
                window.location.href = `product.html?title=${title}&large_description=${description}&price=${price}&image=${image}`;
            });
        });
    }

    window.onload = cargarProductos;
</script>

        <h2>쯀nteresado? Cont치ctanos</h2>
        <a href="https://wa.me/573180187501?text=Hola,%20estoy%20interesado%20en%20sus%20productos%20de%20impresi칩n%203D"
            class="whatsapp-link" target="_blank">
            Enviar mensaje por WhatsApp
        </a>
    </div>

    <script>
        // JavaScript para el carrusel (sin cambios)
        const carousel = document.getElementById('carousel');
        const indicators = document.querySelectorAll('.indicator');
        const prevBtn = document.getElementById('prev');
        const nextBtn = document.getElementById('next');
        let currentSlide = 0;
        const totalSlides = indicators.length;

        function updateCarousel() {
            carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
            indicators.forEach((ind, index) => {
                ind.classList.toggle('active', index === currentSlide);
            });
        }

        nextBtn.addEventListener('click', () => {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
        });

        prevBtn.addEventListener('click', () => {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            updateCarousel();
        });

        indicators.forEach(indicator => {
            indicator.addEventListener('click', () => {
                currentSlide = parseInt(indicator.getAttribute('data-slide'));
                updateCarousel();
            });
        });

        // Auto-play del carrusel
        setInterval(() => {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
        }, 5000); // Cambia cada 5 segundos
    </script>
</body>
</html>